kind: Cluster
apiVersion: kind.x-k8s.io/v1alpha4

nodes:
  - role: control-plane
    image: kindest/node:v1.31.0

  - role: worker
    image: kindest/node:v1.31.0
    extraMounts: &nvidia
      - hostPath: /dev/nvidia0
        containerPath: /dev/nvidia0
      - hostPath: /dev/nvidiactl
        containerPath: /dev/nvidiactl
      - hostPath: /dev/nvidia-uvm
        containerPath: /dev/nvidia-uvm
      - hostPath: /dev/nvidia-uvm-tools
        containerPath: /dev/nvidia-uvm-tools
      - hostPath: /usr/lib/wsl/lib
        containerPath: /usr/lib/wsl/lib

  - role: worker
    image: kindest/node:v1.31.0
    extraMounts: *nvidia

  - role: worker
    image: kindest/node:v1.31.0
    extraMounts: *nvidia

  - role: worker
    image: kindest/node:v1.31.0
    extraMounts: *nvidia

  - role: worker
    image: kindest/node:v1.31.0
    extraMounts: *nvidia

containerdConfigPatches:
  - |
    [plugins."io.containerd.grpc.v1.cri".containerd.runtimes.nvidia]
      runtime_type = "io.containerd.runc.v2"
      privileged_without_host_devices = false
      [plugins."io.containerd.grpc.v1.cri".containerd.runtimes.nvidia.options]
        BinaryName = "/usr/bin/nvidia-container-runtime"
